<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Learn English</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.menu__btn { font-size: 20px; padding: 10px; cursor: pointer; }
.menu__nav { list-style: none; padding: 0; margin: 10px 0; display: none; width: 220px; border: 1px solid #ccc; }
.menu__nav.show { display: block; }
.menu__nav-item { margin: 5px 0; }
.level-btn { font-weight: bold; cursor: pointer; width: 100%; text-align: left; }
.submenu { list-style: none; padding-left: 20px; margin-top: 5px; }
.submenu li { cursor: pointer; margin: 3px 0; }
#lessonContent { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
#progressBarContainer { width: 100%; background: #eee; border: 1px solid #ccc; margin: 10px 0; }
#progressBar { background: #4caf50; color: white; text-align: center; padding: 5px 0; width: 0%; }
textarea { width: 100%; }
button { margin-top: 5px; }
</style>
</head>
<body>

<button class="menu__btn" id="menuBtn">‚ò∞ –ú–µ–Ω—é</button>
<ul class="menu__nav" id="menuDropdown"></ul>

<div id="lessonContent">
  <div id="progressText"></div>
  <div id="progressBarContainer"><div id="progressBar">0%</div></div>

  <!-- –§–∞–∑–∞ 1 -->
  <div id="page3" style="display:none;">
    <h2>–§–∞–∑–∞ 1: –û–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏–µ</h2>
    <p id="card"></p>
    <button onclick="showNextCard()">–î–∞–ª–µ–µ</button>
    <button onclick="repeatPhase(1)">üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø</button>
    <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
  </div>

  <!-- –§–∞–∑–∞ 2 -->
  <div id="page4" style="display:none;">
    <h2>–§–∞–∑–∞ 2: –ü–µ—Ä–µ–≤–æ–¥ ‚Üí –û—Ä–∏–≥–∏–Ω–∞–ª</h2>
    <p id="phase2-translation"></p>
    <button id="showAnswerBtn" onclick="showAnswer()">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
    <div id="answerSection" style="display:none;">
      <p id="phase2-answer"></p>
      <button onclick="markAnswer(true)">‚úÖ</button>
      <button onclick="markAnswer(false)">‚ùå</button>
      <button onclick="repeatPhase(2)">üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø</button>
      <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
    </div>
  </div>

  <!-- –§–∞–∑–∞ 3 -->
  <div id="page5" style="display:none;">
    <h2>–§–∞–∑–∞ 3: –û—Ä–∏–≥–∏–Ω–∞–ª ‚Üí –ü–µ—Ä–µ–≤–æ–¥</h2>
    <p id="phase3-original"></p>
    <button id="showAnswerBtn3" onclick="showAnswer3()">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
    <div id="answerSection3" style="display:none;">
      <p id="phase3-answer"></p>
      <button onclick="markAnswer3(true)">‚úÖ</button>
      <button onclick="markAnswer3(false)">‚ùå</button>
      <button onclick="repeatPhase(3)">üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø</button>
      <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
    </div>
  </div>

  <!-- –§–∞–∑–∞ 4 -->
  <div id="page6" style="display:none;">
    <h2>–§–∞–∑–∞ 4: –î–∏–∫—Ç–∞–Ω—Ç</h2>
    <p id="dictation-translation"></p>
    <input type="text" id="dictation-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–ª–æ–≤–æ" autocomplete="off">
    <button onclick="checkDictation()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <button onclick="nextDictationCard()">‚û° –°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ</button>
    <button onclick="repeatPhase(4)">üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø</button>
    <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
    <p id="dictation-feedback"></p>
  </div>
</div>

<script>
let lessonsDB = {};
let english = [], transcriptions = [], translated = [], examples = [];
let currentIndex = 0;

// --- –ú–µ–Ω—é ---
document.getElementById("menuBtn").addEventListener("click", () => {
  document.getElementById("menuDropdown").classList.toggle("show");
});

fetch('lessons.json')
  .then(res => res.json())
  .then(data => { lessonsDB = data; generateLevelsMenu(Object.keys(lessonsDB)); })
  .catch(err => console.error("–û—à–∏–±–∫–∞ JSON:", err));

function generateLevelsMenu(levels) {
  const menu = document.getElementById("menuDropdown");
  menu.innerHTML = "";
  levels.forEach(level => {
    const li = document.createElement("li");
    li.className = "menu__nav-item";
    const button = document.createElement("button");
    button.textContent = level;
    button.className = "level-btn";
    button.onclick = () => toggleLessons(level, button);
    li.appendChild(button);
    menu.appendChild(li);
  });
}

function toggleLessons(level, button) {
  const existing = button.nextElementSibling;
  if (existing) { existing.remove(); return; }
  const ul = document.createElement("ul");
  ul.className = "submenu";
  const lessons = lessonsDB[level];
  for (const lessonKey in lessons) {
    const lesson = lessons[lessonKey];
    const li = document.createElement("li");
    li.textContent = lesson.title;
    li.onclick = () => loadLesson(level, lessonKey, li);
    ul.appendChild(li);
  }
  button.parentNode.appendChild(ul);
}

// --- –ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–∞ ---
function loadLesson(level, lessonKey, li) {
  const lesson = lessonsDB[level][lessonKey];
  english = lesson.english || [];
  transcriptions = lesson.transcriptions || [];
  translated = lesson.translated || [];
  examples = lesson.example || [];

  document.querySelectorAll(".submenu li").forEach(el => el.style.background = "");
  li.style.background = "#d3f0ff";
  document.getElementById("menuDropdown").classList.remove("show");

  document.querySelectorAll("div[id^='page']").forEach(div => div.style.display = "none");
  document.getElementById("lessonContent").scrollIntoView({ behavior: "smooth" });

  currentIndex = 0;
  startPhase1();
}

// --- –£—Ç–∏–ª–∏—Ç—ã ---
function shuffleArray(arr) { for (let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }
function updateProgress(done,total,phase){const p=Math.round((done/total)*100);document.getElementById("progressText").innerText=`${phase}: ${done}/${total}`;const b=document.getElementById("progressBar");b.style.width=p+"%";b.innerText=p+"%";}

// --- –§–∞–∑–∞ 1 ---
function startPhase1(){document.getElementById("page3").style.display="block";currentIndex=0;showNextCard();}
function showNextCard(){
  if(currentIndex>=english.length){document.getElementById("page3").style.display="none";startPhase2();return;}
  const ex = examples[currentIndex] ? `<br><em>–ü—Ä–∏–º–µ—Ä: ${examples[currentIndex]}</em>`:"";
  document.getElementById("card").innerHTML=`<strong>${english[currentIndex]}</strong> [${transcriptions[currentIndex]||""}]<br>${translated[currentIndex]}${ex}`;
  currentIndex++;updateProgress(currentIndex,english.length,"–§–∞–∑–∞ 1");
}

// --- –§–∞–∑–∞ 2 ---
let queue2=[],currentPair2=null;
function startPhase2(){document.getElementById("page4").style.display="block";queue2=shuffleArray(english.map((w,i)=>({eng:w,rus:translated[i],transcr:transcriptions[i],ex:examples[i]})));nextPhase2Card();}
function nextPhase2Card(){
  if(queue2.length===0){document.getElementById("page4").style.display="none";startPhase3();return;}
  currentPair2=queue2.shift();
  document.getElementById("phase2-translation").innerText=currentPair2.rus;
  document.getElementById("phase2-answer").innerHTML=`${currentPair2.eng} ${currentPair2.transcr?`[${currentPair2.transcr}]`:""}${currentPair2.ex?`<br><em>–ü—Ä–∏–º–µ—Ä: ${currentPair2.ex}</em>`:""}`;
  document.getElementById("answerSection").style.display="none";document.getElementById("showAnswerBtn").style.display="inline-block";
  updateProgress(english.length-queue2.length,english.length,"–§–∞–∑–∞ 2");
}
function showAnswer(){document.getElementById("answerSection").style.display="block";document.getElementById("showAnswerBtn").style.display="none";}
function markAnswer(ok){if(!ok)queue2.push(currentPair2);nextPhase2Card();}

// --- –§–∞–∑–∞ 3 ---
let queue3=[],currentPair3=null;
function startPhase3(){document.getElementById("page5").style.display="block";queue3=shuffleArray(english.map((w,i)=>({eng:w,rus:translated[i],transcr:transcriptions[i],ex:examples[i]})));nextPhase3Card();}
function nextPhase3Card(){
  if(queue3.length===0){document.getElementById("page5").style.display="none";startPhase4();return;}
  currentPair3=queue3.shift();
  document.getElementById("phase3-original").innerText=currentPair3.eng;
  document.getElementById("phase3-answer").innerHTML=`${currentPair3.rus} ${currentPair3.transcr?`[${currentPair3.transcr}]`:""}${currentPair3.ex?`<br><em>–ü—Ä–∏–º–µ—Ä: ${currentPair3.ex}</em>`:""}`;
  document.getElementById("answerSection3").style.display="none";document.getElementById("showAnswerBtn3").style.display="inline-block";
  updateProgress(english.length-queue3.length,english.length,"–§–∞–∑–∞ 3");
}
function showAnswer3(){document.getElementById("answerSection3").style.display="block";document.getElementById("showAnswerBtn3").style.display="none";}
function markAnswer3(ok){if(!ok)queue3.push(currentPair3);nextPhase3Card();}

// --- –§–∞–∑–∞ 4 ---
let queue4=[],currentPair4=null;
function startPhase4(){document.getElementById("page6").style.display="block";queue4=shuffleArray(english.map((w,i)=>({eng:w,rus:translated[i],transcr:transcriptions[i],ex:examples[i]})));nextDictationCard();}
function nextDictationCard(){
  if(queue4.length===0){document.getElementById("dictation-translation").innerText="–§–∞–∑–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ üéâ";document.getElementById("dictation-input").style.display="none";return;}
  currentPair4=queue4.shift();
  document.getElementById("dictation-translation").innerText=currentPair4.rus;
  document.getElementById("dictation-input").value="";document.getElementById("dictation-feedback").innerText="";
  updateProgress(english.length-queue4.length,english.length,"–§–∞–∑–∞ 4");
}
function checkDictation(){
  const ans=document.getElementById("dictation-input").value.trim().toLowerCase();
  const correct=currentPair4.eng.toLowerCase();
  if(ans===correct){document.getElementById("dictation-feedback").innerText=`‚úÖ –í–µ—Ä–Ω–æ: ${currentPair4.eng} [${currentPair4.transcr||""}]`;}
  else{document.getElementById("dictation-feedback").innerText=`‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${currentPair4.eng} [${currentPair4.transcr||""}]`;}
}

// --- –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø ---
function repeatPhase(n){
  document.querySelectorAll("div[id^='page']").forEach(div=>div.style.display="none");
  if(n===1)startPhase1();
  if(n===2)startPhase2();
  if(n===3)startPhase3();
  if(n===4)startPhase4();
}

// --- –ü—Ä–æ–ø—É—Å–∫ —ç—Ç–∞–ø–∞ ---
function goToNextPage(){
  if(document.getElementById("page3").style.display==="block"){document.getElementById("page3").style.display="none";startPhase2();}
  else if(document.getElementById("page4").style.display==="block"){document.getElementById("page4").style.display="none";startPhase3();}
  else if(document.getElementById("page5").style.display==="block"){document.getElementById("page5").style.display="none";startPhase4();}
}
</script>
</body>
</html>
