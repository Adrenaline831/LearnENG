<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Learn English</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.menu__btn { font-size: 20px; padding: 10px; cursor: pointer; }
.menu__nav { list-style: none; padding: 0; margin: 10px 0; display: none; width: 220px; border: 1px solid #ccc; }
.menu__nav.show { display: block; }
.menu__nav-item { margin: 5px 0; }
.level-btn { font-weight: bold; cursor: pointer; width: 100%; text-align: left; }
.submenu { list-style: none; padding-left: 20px; margin-top: 5px; }
.submenu li { cursor: pointer; margin: 3px 0; }
#lessonContent { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
#progressBarContainer { width: 100%; background: #eee; border: 1px solid #ccc; margin: 10px 0; }
#progressBar { background: #4caf50; color: white; text-align: center; padding: 5px 0; width: 0%; }
textarea { width: 100%; }
button { margin-top: 5px; }
</style>
</head>
<body>

<button class="menu__btn" id="menuBtn">‚ò∞ –ú–µ–Ω—é</button>
<ul class="menu__nav" id="menuDropdown"></ul>

<div id="lessonContent">
  <div id="progressText"></div>
  <div id="progressBarContainer">
    <div id="progressBar">0%</div>
  </div>

  <div id="page1">
    <h2>–í–≤–µ–¥–∏—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–ª–æ–≤–∞ (–ø–æ –æ–¥–Ω–æ–º—É –≤ —Å—Ç—Ä–æ–∫—É)</h2>
    <textarea id="englishWords" rows="8" placeholder="cat&#10;dog&#10;pig"></textarea>
    <button onclick="goToTranscription()">–î–∞–ª—å—à–µ</button>
  </div>

  <div id="page1_5" style="display:none;">
    <h2>–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é (–≤ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ)</h2>
    <textarea id="englishTranscription" rows="8" placeholder="k√¶t&#10;d…íg&#10;p…™g"></textarea>
    <button onclick="skipTranscription()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é</button>
    <button onclick="goToTranslations()">–î–∞–ª—å—à–µ</button>
  </div>

  <div id="page2" style="display:none;">
    <h2>–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥—ã (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ)</h2>
    <textarea id="translatedWords" rows="8" placeholder="–∫–æ—Ç&#10;—Å–æ–±–∞–∫–∞&#10;—Å–≤–∏–Ω—å—è"></textarea>
    <button onclick="startPhase1()">–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ</button>
  </div>

  <div id="page3" style="display:none;">
    <h2>–§–∞–∑–∞ 1: –û–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏–µ</h2>
    <p id="card"></p>
    <button onclick="showNextCard()">–î–∞–ª–µ–µ</button>
    <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
  </div>

  <div id="page4" style="display:none;">
    <h2>–§–∞–∑–∞ 2: –ü–µ—Ä–µ–≤–æ–¥ ‚Üí –û—Ä–∏–≥–∏–Ω–∞–ª</h2>
    <p id="phase2-translation"></p>
    <button id="showAnswerBtn" onclick="showAnswer()">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
    <div id="answerSection" style="display:none;">
      <p id="phase2-answer"></p>
      <button onclick="markAnswer(true)">‚úÖ</button>
      <button onclick="markAnswer(false)">‚ùå</button>
      <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
    </div>
  </div>

  <div id="page5" style="display:none;">
    <h2>–§–∞–∑–∞ 3: –û—Ä–∏–≥–∏–Ω–∞–ª ‚Üí –ü–µ—Ä–µ–≤–æ–¥</h2>
    <p id="phase3-original"></p>
    <button id="showAnswerBtn3" onclick="showAnswer3()">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
    <div id="answerSection3" style="display:none;">
      <p id="phase3-answer"></p>
      <button onclick="markAnswer3(true)">‚úÖ</button>
      <button onclick="markAnswer3(false)">‚ùå</button>
      <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
    </div>
  </div>

  <div id="page6" style="display:none;">
    <h2>–§–∞–∑–∞ 4: –î–∏–∫—Ç–∞–Ω—Ç</h2>
    <p id="dictation-translation"></p>
    <input type="text" id="dictation-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–ª–æ–≤–æ" autocomplete="off">
    <button onclick="checkDictation()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
    <p id="dictation-feedback"></p>
  </div>
</div>

<script>
let lessonsDB = {};
let english = [];
let transcriptions = [];
let translated = [];
let currentIndex = 0;

// --- –ú–µ–Ω—é ---
document.getElementById("menuBtn").addEventListener("click", () => {
  document.getElementById("menuDropdown").classList.toggle("show");
});

// --- –ó–∞–≥—Ä—É–∑–∫–∞ JSON –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ–Ω—é ---
fetch('lessons.json')
  .then(res => res.json())
  .then(data => {
    lessonsDB = data;
    generateLevelsMenu(Object.keys(lessonsDB));
  })
  .catch(err => console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ JSON:", err));

function generateLevelsMenu(levels) {
  const menu = document.getElementById("menuDropdown");
  menu.innerHTML = "";

  levels.forEach(level => {
    const li = document.createElement("li");
    li.className = "menu__nav-item";

    const button = document.createElement("button");
    button.textContent = level;
    button.className = "level-btn";
    button.onclick = () => toggleLessons(level, button);

    li.appendChild(button);
    menu.appendChild(li);
  });
}

function toggleLessons(level, button) {
  const existing = button.nextElementSibling;
  if (existing) { existing.remove(); return; }

  const ul = document.createElement("ul");
  ul.className = "submenu";

  const lessons = lessonsDB[level];
  for (const lessonKey in lessons) {
    const lesson = lessons[lessonKey];
    const li = document.createElement("li");
    li.textContent = lesson.title;
    li.style.cursor = "pointer";
    li.onclick = () => loadLesson(level, lessonKey, li);
    ul.appendChild(li);
  }

  button.parentNode.appendChild(ul);
}

// --- –ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥ —Å—Ä–∞–∑—É –∫ —Ñ–∞–∑–µ 1 ---
function loadLesson(level, lessonKey, lessonElement) {
  const lesson = lessonsDB[level][lessonKey];
  if (!lesson) return console.error("–£—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω:", level, lessonKey);

  // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—Ä–æ–∫–∞
  document.querySelectorAll(".submenu li").forEach(li => li.style.background = "");
  lessonElement.style.background = "#d3f0ff";

  english = lesson.english || [];
  transcriptions = lesson.transcriptions || [];
  translated = lesson.translated || [];

  // –°–∫—Ä—ã—Ç—å –º–µ–Ω—é
  document.getElementById("menuDropdown").classList.remove("show");

  // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  document.querySelectorAll("div[id^='page']").forEach(div => div.style.display = "none");

  // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —É—Ä–æ–∫–∞
  document.getElementById("lessonContent").scrollIntoView({ behavior: "smooth" });

  // –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ —Å—Ç–∞—Ä—Ç –ø–µ—Ä–≤–æ–π —Ñ–∞–∑—ã
  currentIndex = 0;
  startPhase1();
}

// --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function updateProgress(done, total, phaseName) {
  const percent = Math.round((done / total) * 100);
  document.getElementById("progressText").innerText = ${phaseName}: ${done} / ${total};
  const bar = document.getElementById("progressBar");
  bar.style.width = percent + "%";
  bar.innerText = percent + "%";
}

// --- –§–∞–∑–∞ 1 ---
function startPhase1() {
  document.getElementById("page1").style.display = "none";
  document.getElementById("page1_5").style.display = "none";
  document.getElementById("page2").style.display = "none";
  document.getElementById("page3").style.display = "block";
  showNextCard();
}

function showNextCard() {
  if (currentIndex >= english.length) {
    document.getElementById("page3").style.display = "none";
    startPhase2();
    return;
  }
  const eng = english[currentIndex];
  const transcr = transcriptions[currentIndex] ? [${transcriptions[currentIndex]}] : "";
  const rus = translated[currentIndex];
  const card = document.getElementById("card");
  card.style.opacity = 0;
  card.innerHTML = <strong>${eng}</strong> ${transcr}<br>${rus};
  setTimeout(() => { card.style.opacity = 1; }, 50);

  currentIndex++;
  updateProgress(currentIndex, english.length, "–§–∞–∑–∞ 1");
}

// --- –§–∞–∑–∞ 2 ---
let queue2 = [], currentPair2 = null;

function startPhase2() {
  document.getElementById("page4").style.display = "block";
  queue2 = english.map((w, i) => ({ eng: w, rus: translated[i], transcr: transcriptions[i] }));
  queue2 = shuffleArray(queue2);
  nextPhase2Card();
}

function nextPhase2Card() {
  if (queue2.length === 0) {
    document.getElementById("page4").style.display = "none";
    startPhase3();
    return;
  }
  currentPair2 = queue2.shift();
  document.getElementById("phase2-translation").innerText = currentPair2.rus;
  document.getElementById("phase2-answer").innerText = ${currentPair2.eng} ${currentPair2.transcr ? "[" + currentPair2.transcr + "]" : ""};
  document.getElementById("answerSection").style.display = "none";
  document.getElementById("showAnswerBtn").style.display = "inline-block";
  updateProgress(english.length - queue2.length, english.length, "–§–∞–∑–∞ 2");
}

function showAnswer() {
  document.getElementById("answerSection").style.display = "block";
  document.getElementById("showAnswerBtn").style.display = "none";
}

function markAnswer(correct) {
  if (!correct) queue2.push(currentPair2);
  nextPhase2Card();
}

// --- –§–∞–∑–∞ 3 ---
let queue3 = [], currentPair3 = null;

function startPhase3() {
  document.getElementById("page5").style.display = "block";
  queue3 = english.map((w, i) => ({ eng: w, rus: translated[i], transcr: transcriptions[i] }));
  queue3 = shuffleArray(queue3);
  nextPhase3Card();
}

function nextPhase3Card() {
  if (queue3.length === 0) {
    document.getElementById("page5").style.display = "none";
    startPhase4();
    return;
  }
  currentPair3 = queue3.shift();
  document.getElementById("phase3-original").innerText = currentPair3.eng;
  document.getElementById("phase3-answer").innerText = ${currentPair3.rus} ${currentPair3.transcr ? "[" + currentPair3.transcr + "]" : ""};
  document.getElementById("answerSection3").style.display = "none";
  document.getElementById("showAnswerBtn3").style.display = "inline-block";
  updateProgress(english.length - queue3.length, english.length, "–§–∞–∑–∞ 3");
}

function showAnswer3() {
  document.getElementById("answerSection3").style.display = "block";
  document.getElementById("showAnswerBtn3").style.display = "none";
}

function markAnswer3(correct) {
  if (!correct) queue3.push(currentPair3);
  nextPhase3Card();
}

// --- –§–∞–∑–∞ 4 ---
let queue4 = [], currentPair4 = null;

function startPhase4() {
  document.getElementById("page5").style.display = "none";
  document.getElementById("page6").style.display = "block";
  queue4 = english.map((w, i) => ({ eng: w, rus: translated[i], transcr: transcriptions[i] }));
  queue4 = shuffleArray(queue4);
  nextDictationCard();
}

function nextDictationCard() {
  document.getElementById("dictation-feedback").innerText = "";
  document.getElementById("dictation-input").value = "";
  document.getElementById("dictation-input").style.display = "inline-block";

  if (queue4.length === 0) {
    document.getElementById("dictation-translation").innerText = "–§–∞–∑–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéâ";
    document.getElementById("dictation-input").style.display = "none";
    updateProgress(english.length, english.length, "–§–∞–∑–∞ 4");
    return;
  }

  currentPair4 = queue4.shift();
  document.getElementById("dictation-translation").innerText = currentPair4.rus;
  updateProgress(english.length - queue4.length, english.length, "–§–∞–∑–∞ 4");
}

function checkDictation() {
  const userInput = document.getElementById("dictation-input").value.trim().toLowerCase();
  const correctAnswer = currentPair4.eng.toLowerCase();
  if (userInput === correctAnswer) {
    document.getElementById("dictation-feedback").innerText = ‚úÖ –í–µ—Ä–Ω–æ! ${currentPair4.eng} ${currentPair4.transcr ? "[" + currentPair4.transcr + "]" : ""};
  } else {
    document.getElementById("dictation-feedback").innerText = ‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${currentPair4.eng} ${currentPair4.transcr ? "[" + currentPair4.transcr + "]" : ""};
    queue4.push(currentPair4);
  }
  setTimeout(() => { nextDictationCard(); }, 1000);
}

// --- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø" ---
function goToNextPage() {
  if (document.getElementById("page3").style.display === "block") {
    document.getElementById("page3").style.display = "none";
    startPhase2();
  } else if (document.getElementById("page4").style.display === "block") {
    document.getElementById("page4").style.display = "none";
    startPhase3();
  } else if (document.getElementById("page5").style.display === "block") {
    document.getElementById("page5").style.display = "none";
    startPhase4();
  }
}

</script>

</body>
</html>

