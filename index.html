<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Learn English</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.menu__btn { font-size: 20px; padding: 10px; cursor: pointer; }
.menu__nav { list-style: none; padding: 0; margin: 10px 0; display: none; width: 220px; border: 1px solid #ccc; }
.menu__nav.show { display: block; }
.menu__nav-item { margin: 5px 0; }
.level-btn { font-weight: bold; cursor: pointer; width: 100%; text-align: left; }
.submenu { list-style: none; padding-left: 20px; margin-top: 5px; }
.submenu li { cursor: pointer; margin: 3px 0; }
.submenu li.active { background: #d0f0d0; font-weight: bold; }
#lessonContent { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
#progressBarContainer { width: 100%; background: #eee; border: 1px solid #ccc; margin: 10px 0; }
#progressBar { background: #4caf50; color: white; text-align: center; padding: 5px 0; width: 0%; transition: width 0.4s; }
.hidden { display: none; }
.example { font-style: italic; color: #555; margin-top: 5px; }
button { margin: 5px; }
textarea { width: 100%; }
</style>
</head>
<body>

<!-- –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é -->
<button class="menu__btn" id="menuBtn">‚ò∞ –ú–µ–Ω—é</button>
<ul class="menu__nav" id="menuDropdown"></ul>

<div id="lessonContent">
  <div id="progressText"></div>
  <div id="progressBarContainer">
    <div id="progressBar">0%</div>
  </div>

  <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 0: —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –≤–≤–æ–¥ —Å–ª–æ–≤ -->
  <div id="page0">
    <h2>–í–≤–µ–¥–∏—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–ª–æ–≤–∞ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É)</h2>
    <textarea id="englishWords" rows="8" placeholder="cat&#10;dog&#10;pig"></textarea><br>
    <button onclick="goToTranscription()">–î–∞–ª—å—à–µ</button>
  </div>

  <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ -->
  <div id="page1_5" class="hidden">
    <h2>–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ (–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)</h2>
    <textarea id="englishTranscription" rows="8" placeholder="k√¶t&#10;d…íg&#10;p…™g"></textarea><br>
    <button onclick="skipTranscription()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
    <button onclick="goToTranslations()">–î–∞–ª—å—à–µ</button>
  </div>

  <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: –ø–µ—Ä–µ–≤–æ–¥—ã -->
  <div id="page2" class="hidden">
    <h2>–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥—ã (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É)</h2>
    <textarea id="translatedWords" rows="8" placeholder="–∫–æ—Ç&#10;—Å–æ–±–∞–∫–∞&#10;—Å–≤–∏–Ω—å—è"></textarea><br>
    <button onclick="startSelfLearning()">–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ</button>
  </div>

  <!-- –§–∞–∑—ã –æ–±—É—á–µ–Ω–∏—è -->
  <div id="page3" class="hidden">
    <h2>–§–∞–∑–∞ 1: –û–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏–µ</h2>
    <p id="card"></p>
    <div class="example" id="cardExample"></div>
    <button onclick="showNextCard()">–î–∞–ª–µ–µ</button>
    <button onclick="repeatPhase()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø</button>
    <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
  </div>

  <div id="page4" class="hidden">
    <h2>–§–∞–∑–∞ 2: –ü–µ—Ä–µ–≤–æ–¥ ‚Üí –û—Ä–∏–≥–∏–Ω–∞–ª</h2>
    <p id="phase2-translation"></p>
    <div class="example" id="phase2-example"></div>
    <button id="showAnswerBtn" onclick="showAnswer()">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
    <div id="answerSection" class="hidden">
      <p id="phase2-answer"></p>
      <button onclick="markAnswer(true)">‚úÖ</button>
      <button onclick="markAnswer(false)">‚ùå</button>
      <button onclick="repeatPhase()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø</button>
      <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
    </div>
  </div>

  <div id="page5" class="hidden">
    <h2>–§–∞–∑–∞ 3: –û—Ä–∏–≥–∏–Ω–∞–ª ‚Üí –ü–µ—Ä–µ–≤–æ–¥</h2>
    <p id="phase3-original"></p>
    <div class="example" id="phase3-example"></div>
    <button id="showAnswerBtn3" onclick="showAnswer3()">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
    <div id="answerSection3" class="hidden">
      <p id="phase3-answer"></p>
      <button onclick="markAnswer3(true)">‚úÖ</button>
      <button onclick="markAnswer3(false)">‚ùå</button>
      <button onclick="repeatPhase()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø</button>
      <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
    </div>
  </div>

  <div id="page6" class="hidden">
    <h2>–§–∞–∑–∞ 4: –î–∏–∫—Ç–∞–Ω—Ç</h2>
    <p id="dictation-translation"></p>
    <div class="example" id="dictation-example"></div>
    <input type="text" id="dictation-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–ª–æ–≤–æ" autocomplete="off">
    <button onclick="checkDictation()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <button onclick="nextDictationAfterError()">–°–ª–µ–¥—É—é—â–µ–µ</button>
    <p id="dictation-feedback"></p>
  </div>

  <div id="finishPage" class="hidden">
    <h2>üéâ –£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω!</h2>
    <button onclick="backToMenu()">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –º–µ–Ω—é</button>
  </div>
</div>

<script>
// === –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ===
let lessonsDB = {};
let currentLesson = null;
let words = [];
let transcriptions = [];
let translations = [];
let examples = [];
let currentPhase = 0;
let currentIndex = 0;
let wrongQueue = [];
let dictationQueue = [];
let dictationWaiting = false;

// === –ó–∞–≥—Ä—É–∂–∞–µ–º JSON –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ===
fetch("lessons.json")
  .then(res => res.json())
  .then(data => {
    lessonsDB = data;
    generateLevelsMenu();
  })
  .catch(err => console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ JSON:", err));

// === –ú–µ–Ω—é ===
document.getElementById("menuBtn").addEventListener("click", () => {
  document.getElementById("menuDropdown").classList.toggle("show");
});

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π –∏ —É—Ä–æ–∫–æ–≤
function generateLevelsMenu() {
  const menu = document.getElementById("menuDropdown");
  menu.innerHTML = "";

  Object.keys(lessonsDB).forEach(level => {
    const li = document.createElement("li");
    li.classList.add("menu__nav-item");

    // –ö–Ω–æ–ø–∫–∞ —É—Ä–æ–≤–Ω—è (A1, A2, B1...C2)
    const btn = document.createElement("button");
    btn.textContent = level;
    btn.classList.add("level-btn");
    li.appendChild(btn);

    // –ü–æ–¥–º–µ–Ω—é –¥–ª—è —É—Ä–æ–∫–æ–≤
    const ul = document.createElement("ul");
    ul.classList.add("submenu");

    Object.keys(lessonsDB[level]).forEach(lessonKey => {
      const lessonLi = document.createElement("li");
      lessonLi.textContent = lessonsDB[level][lessonKey].title;

      lessonLi.addEventListener("click", () => {
        startLesson(level, lessonKey);

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—Ä–æ–∫–∞
        document.querySelectorAll(".submenu li").forEach(el => el.classList.remove("active-lesson"));
        lessonLi.classList.add("active-lesson");

        // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–Ω–∏–∑ –∫ –∫–∞—Ä—Ç–æ—á–∫–∞–º —É—Ä–æ–∫–∞
        setTimeout(() => {
          document.getElementById("page3").scrollIntoView({ behavior: "smooth", block: "start" });
        }, 300);
      });

      ul.appendChild(lessonLi);
    });

    li.appendChild(ul);
    menu.appendChild(li);

    // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤
    btn.addEventListener("click", () => {
      ul.classList.toggle("show");
    });
  });
}

// –ó–∞–ø—É—Å–∫ —É—Ä–æ–∫–∞
function startLesson(level, lessonKey) {
  const lesson = lessonsDB[level][lessonKey];
  if (!lesson) return;

  words = lesson.english;
  transcriptions = lesson.transcriptions;
  translations = lesson.translated;
  examples = lesson.example || [];
  currentPhase = 3;
  currentIndex = 0;
  wrongQueue = [];

  startPhase(currentPhase);
  document.getElementById("menuDropdown").classList.remove("show");
}

// === –í–≤–æ–¥ —Å–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ===
function hideAllPages() {
  ["page0","page1_5","page2","page3","page4","page5","page6","finishPage"].forEach(id =>
    document.getElementById(id).classList.add("hidden")
  );
}

function goToTranscription() {
  const rawWords = document.getElementById("englishWords").value.trim();
  if (!rawWords) { alert("–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–ª–æ–≤–æ"); return; }
  words = rawWords.split("\n").map(s => s.trim());
  hideAllPages();
  document.getElementById("page1_5").classList.remove("hidden");
}

function skipTranscription() {
  transcriptions = words.map(_ => "");
  goToTranslations();
}

function goToTranslations() {
  const rawTranscriptions = document.getElementById("englishTranscription").value.trim();
  if (rawTranscriptions) {
    transcriptions = rawTranscriptions.split("\n").map(s => s.trim());
    if (transcriptions.length !== words.length) {
      alert("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–π –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–ª–æ–≤");
      return;
    }
  } else {
    transcriptions = words.map(_ => "");
  }
  hideAllPages();
  document.getElementById("page2").classList.remove("hidden");
}

function startSelfLearning() {
  const rawTranslations = document.getElementById("translatedWords").value.trim();
  if (!rawTranslations) { alert("–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥—ã"); return; }
  translations = rawTranslations.split("\n").map(s => s.trim());
  if (translations.length !== words.length) {
    alert("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–ª–æ–≤");
    return;
  }
  examples = words.map(_ => "");
  currentPhase = 3;
  currentIndex = 0;
  wrongQueue = [];
  startPhase(currentPhase);
}

// === –õ–æ–≥–∏–∫–∞ —Ñ–∞–∑ ===
function startPhase(phase) {
  hideAllPages();
  currentPhase = phase;
  currentIndex = 0;
  wrongQueue = [];

  updateProgress();

  if (phase === 3) showNextCard();
  if (phase === 4) showPhase2();
  if (phase === 5) showPhase3();
  if (phase === 6) startDictationPhase();
}

function updateProgress() {
  const total = words.length;
  const done = currentIndex;
  const percent = Math.min(100, Math.round((done / total) * 100));
  document.getElementById("progressText").textContent = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${done}/${total}`;
  document.getElementById("progressBar").style.width = percent + "%";
  document.getElementById("progressBar").textContent = percent + "%";
}

// === –§–∞–∑—ã 1‚Äì3 ===
function showNextCard() {
  if (currentIndex >= words.length) { goToNextPage(); return; }
  document.getElementById("page3").classList.remove("hidden");
  document.getElementById("card").innerHTML =
    `<strong>${words[currentIndex]}</strong> [${transcriptions[currentIndex]}] ‚Äî ${translations[currentIndex]}`;
  document.getElementById("cardExample").textContent = examples[currentIndex] || "";
  currentIndex++;
  updateProgress();
}

function showPhase2() {
  if (currentIndex >= words.length && wrongQueue.length === 0) { goToNextPage(); return; }
  document.getElementById("page4").classList.remove("hidden");
  document.getElementById("answerSection").classList.add("hidden");
  const i = getCurrentIndex();
  document.getElementById("phase2-translation").textContent = translations[i];
  document.getElementById("phase2-example").textContent = examples[i] || "";
}

function showAnswer() {
  const i = getCurrentIndex();
  document.getElementById("phase2-answer").textContent = `${words[i]} [${transcriptions[i]}]`;
  document.getElementById("answerSection").classList.remove("hidden");
}

function markAnswer(correct) {
  const i = getCurrentIndex();
  if (!correct) wrongQueue.push(i);
  nextIndex();
  showPhase2();
}

function showPhase3() {
  if (currentIndex >= words.length && wrongQueue.length === 0) { goToNextPage(); return; }
  document.getElementById("page5").classList.remove("hidden");
  document.getElementById("answerSection3").classList.add("hidden");
  const i = getCurrentIndex();
  document.getElementById("phase3-original").textContent = words[i];
  document.getElementById("phase3-example").textContent = examples[i] || "";
}

function showAnswer3() {
  const i = getCurrentIndex();
  document.getElementById("phase3-answer").textContent = translations[i];
  document.getElementById("answerSection3").classList.remove("hidden");
}

function markAnswer3(correct) {
  const i = getCurrentIndex();
  if (!correct) wrongQueue.push(i);
  nextIndex();
  showPhase3();
}

// === –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ ===
function nextIndex() {
  if (wrongQueue.length > 0) currentIndex = wrongQueue.shift();
  else currentIndex++;
  updateProgress();
}

function getCurrentIndex() {
  return (wrongQueue.length > 0) ? wrongQueue[0] : currentIndex;
}

function goToNextPage() {
  if (currentPhase === 3) startPhase(4);
  else if (currentPhase === 4) startPhase(5);
  else if (currentPhase === 5) startPhase(6);
  else finishLesson();
}

// === –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø (–≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Ñ–∞–∑—É) ===
function repeatPhase() {
  if (currentPhase > 3) {
    startPhase(currentPhase - 1); // –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Ñ–∞–∑—É
  } else {
    startPhase(3); // –µ—Å–ª–∏ –Ω–∞ —Ñ–∞–∑–µ 3 ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —É—Ä–æ–∫–∞
  }
}

function finishLesson() {
  hideAllPages();
  document.getElementById("finishPage").classList.remove("hidden");
}

function backToMenu() {
  hideAllPages();
  document.getElementById("page0").classList.remove("hidden");
  document.getElementById("menuDropdown").classList.add("show");
}

// === –î–∏–∫—Ç–∞–Ω—Ç (–§–∞–∑–∞ 4) ===
function startDictationPhase() {
  dictationQueue = words.map((_, i) => i);
  currentIndex = 0;
  dictationWaiting = false;
  showNextDictationWord();
}

function showNextDictationWord() {
  if (dictationQueue.length === 0) { finishLesson(); return; }
  currentIndex = dictationQueue[0];
  dictationWaiting = false;
  hideAllPages();
  document.getElementById("page6").classList.remove("hidden");
  document.getElementById("dictation-translation").textContent = translations[currentIndex];
  document.getElementById("dictation-example").textContent = examples[currentIndex] || "";
  document.getElementById("dictation-input").value = "";
  document.getElementById("dictation-feedback").textContent = "";
}

function checkDictation() {
  if (dictationWaiting) return;
  const input = document.getElementById("dictation-input").value.trim();
  if (input.toLowerCase() === words[currentIndex].toLowerCase()) {
    document.getElementById("dictation-feedback").textContent = "‚úÖ –í–µ—Ä–Ω–æ!";
    dictationQueue.shift();
    setTimeout(showNextDictationWord, 600);
  } else {
    document.getElementById("dictation-feedback").textContent = `‚ùå –û—à–∏–±–∫–∞. –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${words[currentIndex]}`;
    dictationQueue.push(dictationQueue.shift());
    dictationWaiting = true;
  }
}

function nextDictationAfterError() {
  if (!dictationWaiting) return;
  showNextDictationWord();
}

// === –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ ===
document.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    if (!document.getElementById("page3").classList.contains("hidden")) showNextCard();
    if (!document.getElementById("page4").classList.contains("hidden")) {
      if (document.getElementById("answerSection").classList.contains("hidden")) showAnswer();
      else markAnswer(true);
    }
    if (!document.getElementById("page5").classList.contains("hidden")) {
      if (document.getElementById("answerSection3").classList.contains("hidden")) showAnswer3();
      else markAnswer3(true);
    }
    if (!document.getElementById("page6").classList.contains("hidden")) checkDictation();
  }
  if (e.code === "Space") {
    if (!document.getElementById("page4").classList.contains("hidden")) showAnswer();
    if (!document.getElementById("page5").classList.contains("hidden")) showAnswer3();
  }
});

</script>
</body>
</html>



