<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Learn English</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .menu__btn { font-size: 20px; padding: 10px; cursor: pointer; }
    .menu__nav { list-style: none; padding: 0; margin: 10px 0; display: none; width: 220px; border: 1px solid #ccc; }
    .menu__nav.show { display: block; }
    .menu__nav-item { margin: 5px 0; }
    .level-btn { font-weight: bold; cursor: pointer; width: 100%; text-align: left; }
    .submenu { list-style: none; padding-left: 20px; margin-top: 5px; }
    .submenu li { cursor: pointer; margin: 3px 0; }
    .submenu li.active { background: #d0f0d0; font-weight: bold; }
    #lessonContent { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
    #progressBarContainer { width: 100%; background: #eee; border: 1px solid #ccc; margin: 10px 0; }
    #progressBar { background: #4caf50; color: white; text-align: center; padding: 5px 0; width: 0%; transition: width 0.4s; }
    .hidden { display: none; }
    .example { font-style: italic; color: #555; margin-top: 5px; }
    button { margin: 5px; }
  </style>
</head>
<body>

<!-- –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é -->
<button class="menu__btn" id="menuBtn">‚ò∞ –ú–µ–Ω—é</button>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É—Ä–æ–≤–Ω–µ–π -->
<ul class="menu__nav" id="menuDropdown"></ul>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —É—Ä–æ–∫–∞ -->
<div id="lessonContent">
  <div id="progressText"></div>
  <div id="progressBarContainer">
    <div id="progressBar">0%</div>
  </div>

  <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <div id="page3" class="hidden">
    <h2>–§–∞–∑–∞ 1: –û–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏–µ</h2>
    <p id="card"></p>
    <div class="example" id="cardExample"></div>
    <button onclick="showNextCard()">–î–∞–ª–µ–µ</button>
    <button onclick="repeatPhase()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø</button>
    <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
  </div>

  <div id="page4" class="hidden">
    <h2>–§–∞–∑–∞ 2: –ü–µ—Ä–µ–≤–æ–¥ ‚Üí –û—Ä–∏–≥–∏–Ω–∞–ª</h2>
    <p id="phase2-translation"></p>
    <div class="example" id="phase2-example"></div>
    <button id="showAnswerBtn" onclick="showAnswer()">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
    <div id="answerSection" class="hidden">
      <p id="phase2-answer"></p>
      <button onclick="markAnswer(true)">‚úÖ</button>
      <button onclick="markAnswer(false)">‚ùå</button>
      <button onclick="repeatPhase()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø</button>
      <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
    </div>
  </div>

  <div id="page5" class="hidden">
    <h2>–§–∞–∑–∞ 3: –û—Ä–∏–≥–∏–Ω–∞–ª ‚Üí –ü–µ—Ä–µ–≤–æ–¥</h2>
    <p id="phase3-original"></p>
    <div class="example" id="phase3-example"></div>
    <button id="showAnswerBtn3" onclick="showAnswer3()">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
    <div id="answerSection3" class="hidden">
      <p id="phase3-answer"></p>
      <button onclick="markAnswer3(true)">‚úÖ</button>
      <button onclick="markAnswer3(false)">‚ùå</button>
      <button onclick="repeatPhase()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø</button>
      <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
    </div>
  </div>

  <div id="page6" class="hidden">
    <h2>–§–∞–∑–∞ 4: –î–∏–∫—Ç–∞–Ω—Ç</h2>
    <p id="dictation-translation"></p>
    <div class="example" id="dictation-example"></div>
    <input type="text" id="dictation-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–ª–æ–≤–æ" autocomplete="off">
    <button onclick="checkDictation()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <button onclick="repeatPhase()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–∞–ø</button>
    <button onclick="goToNextPage()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø</button>
    <p id="dictation-feedback"></p>
  </div>

  <div id="finishPage" class="hidden">
    <h2>üéâ –£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω!</h2>
    <button onclick="backToMenu()">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –º–µ–Ω—é</button>
  </div>
</div>

<script>
// === –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ===
let lessonsDB = {};
let currentLesson = null;
let words = [];
let transcriptions = [];
let translations = [];
let examples = [];
let currentPhase = 3;
let currentIndex = 0;
let wrongQueue = [];

// –ó–∞–≥—Ä—É–∂–∞–µ–º JSON
fetch("lessons.json")
  .then(res => res.json())
  .then(data => {
    lessonsDB = data;
    generateLevelsMenu(Object.keys(lessonsDB));
  })
  .catch(err => console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ JSON:", err));

// –ú–µ–Ω—é
document.getElementById("menuBtn").addEventListener("click", () => {
  document.getElementById("menuDropdown").classList.toggle("show");
});

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —É—Ä–æ–≤–Ω–µ–π
function generateLevelsMenu(levels) {
  const menu = document.getElementById("menuDropdown");
  menu.innerHTML = "";

  levels.forEach(level => {
    const li = document.createElement("li");
    li.className = "menu__nav-item";

    const button = document.createElement("button");
    button.textContent = level;
    button.className = "level-btn";
    button.onclick = () => toggleLessons(level, button);

    li.appendChild(button);
    menu.appendChild(li);
  });
}

// –ü–æ–¥—É—Ä–æ–≤–Ω–∏
function toggleLessons(level, button) {
  const existing = button.nextElementSibling;
  if (existing) { existing.remove(); return; }

  const ul = document.createElement("ul");
  ul.className = "submenu";

  const lessons = lessonsDB[level];
  for (const lessonKey in lessons) {
    const lesson = lessons[lessonKey];
    const li = document.createElement("li");
    li.textContent = lesson.title;
    li.onclick = () => loadLesson(level, lessonKey, li);
    ul.appendChild(li);
  }

  button.parentNode.appendChild(ul);
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–∞
function loadLesson(level, lessonKey, liEl) {
  document.querySelectorAll(".submenu li").forEach(li => li.classList.remove("active"));
  liEl.classList.add("active");

  const lesson = lessonsDB[level][lessonKey];
  currentLesson = lesson;
  words = [...lesson.english];
  transcriptions = [...lesson.transcriptions];
  translations = [...lesson.translated];
  examples = [...lesson.example];

  currentPhase = 3;
  currentIndex = 0;
  wrongQueue = [];

  startPhase(currentPhase);

  document.getElementById("lessonContent").scrollIntoView({ behavior: "smooth" });
}

// === –õ–æ–≥–∏–∫–∞ —Ñ–∞–∑ ===
function startPhase(phase) {
  hideAllPages();
  currentPhase = phase;
  currentIndex = 0;
  wrongQueue = [];

  updateProgress();

  if (phase === 3) showNextCard();
  if (phase === 4) showPhase2();
  if (phase === 5) showPhase3();
  if (phase === 6) showDictation();
}

function hideAllPages() {
  ["page3","page4","page5","page6","finishPage"].forEach(id =>
    document.getElementById(id).classList.add("hidden")
  );
}

function updateProgress() {
  const total = words.length;
  const done = currentIndex;
  const percent = Math.min(100, Math.round((done / total) * 100));
  document.getElementById("progressText").textContent = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${done}/${total}`;
  document.getElementById("progressBar").style.width = percent + "%";
  document.getElementById("progressBar").textContent = percent + "%";
}

// === –§–∞–∑–∞ 1 ===
function showNextCard() {
  if (currentIndex >= words.length) { goToNextPage(); return; }
  document.getElementById("page3").classList.remove("hidden");
  document.getElementById("card").innerHTML =
    `<strong>${words[currentIndex]}</strong> [${transcriptions[currentIndex]}] ‚Äî ${translations[currentIndex]}`;
  document.getElementById("cardExample").textContent = examples[currentIndex] || "";
  currentIndex++;
  updateProgress();
}

// === –§–∞–∑–∞ 2 ===
function showPhase2() {
  if (currentIndex >= words.length && wrongQueue.length === 0) { goToNextPage(); return; }
  document.getElementById("page4").classList.remove("hidden");
  document.getElementById("answerSection").classList.add("hidden");
  const i = getCurrentIndex();
  document.getElementById("phase2-translation").textContent = translations[i];
  document.getElementById("phase2-example").textContent = examples[i] || "";
}

function showAnswer() {
  const i = getCurrentIndex();
  document.getElementById("phase2-answer").textContent = `${words[i]} [${transcriptions[i]}]`;
  document.getElementById("answerSection").classList.remove("hidden");
}

function markAnswer(correct) {
  const i = getCurrentIndex();
  if (!correct) wrongQueue.push(i);
  nextIndex();
  showPhase2();
}

// === –§–∞–∑–∞ 3 ===
function showPhase3() {
  if (currentIndex >= words.length && wrongQueue.length === 0) { goToNextPage(); return; }
  document.getElementById("page5").classList.remove("hidden");
  document.getElementById("answerSection3").classList.add("hidden");
  const i = getCurrentIndex();
  document.getElementById("phase3-original").textContent = words[i];
  document.getElementById("phase3-example").textContent = examples[i] || "";
}

function showAnswer3() {
  const i = getCurrentIndex();
  document.getElementById("phase3-answer").textContent = translations[i];
  document.getElementById("answerSection3").classList.remove("hidden");
}

function markAnswer3(correct) {
  const i = getCurrentIndex();
  if (!correct) wrongQueue.push(i);
  nextIndex();
  showPhase3();
}

// === –§–∞–∑–∞ 4 ===
function showDictation() {
  if (currentIndex >= words.length && wrongQueue.length === 0) { finishLesson(); return; }
  document.getElementById("page6").classList.remove("hidden");
  const i = getCurrentIndex();
  document.getElementById("dictation-translation").textContent = translations[i];
  document.getElementById("dictation-example").textContent = examples[i] || "";
  document.getElementById("dictation-input").value = "";
  document.getElementById("dictation-feedback").textContent = "";
}

function checkDictation() {
  const i = getCurrentIndex();
  const input = document.getElementById("dictation-input").value.trim();
  if (input.toLowerCase() === words[i].toLowerCase()) {
    document.getElementById("dictation-feedback").textContent = "‚úÖ –í–µ—Ä–Ω–æ!";
    nextIndex();
    setTimeout(showDictation, 600);
  } else {
    document.getElementById("dictation-feedback").textContent =
      `‚ùå –û—à–∏–±–∫–∞. –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${words[i]}`;
    wrongQueue.push(i);
  }
}

// === –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ ===
function nextIndex() {
  if (wrongQueue.length > 0) currentIndex = wrongQueue.shift();
  else currentIndex++;
  updateProgress();
}

function getCurrentIndex() {
  return (wrongQueue.length > 0) ? wrongQueue[0] : currentIndex;
}

function goToNextPage() {
  if (currentPhase === 3) startPhase(4);
  else if (currentPhase === 4) startPhase(5);
  else if (currentPhase === 5) startPhase(6);
  else finishLesson();
}

function repeatPhase() {
  startPhase(currentPhase);
}

function finishLesson() {
  hideAllPages();
  document.getElementById("finishPage").classList.remove("hidden");
}

function backToMenu() {
  hideAllPages();
  document.getElementById("menuDropdown").classList.add("show");
}

// === –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ ===
document.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    if (!document.getElementById("page3").classList.contains("hidden")) showNextCard();
    if (!document.getElementById("page4").classList.contains("hidden")) {
      if (document.getElementById("answerSection").classList.contains("hidden")) showAnswer();
      else markAnswer(true);
    }
    if (!document.getElementById("page5").classList.contains("hidden")) {
      if (document.getElementById("answerSection3").classList.contains("hidden")) showAnswer3();
      else markAnswer3(true);
    }
    if (!document.getElementById("page6").classList.contains("hidden")) checkDictation();
  }
  if (e.code === "Space") {
    if (!document.getElementById("page4").classList.contains("hidden")) showAnswer();
    if (!document.getElementById("page5").classList.contains("hidden")) showAnswer3();
  }
});
</script>
</body>
</html>

